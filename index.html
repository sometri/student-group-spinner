<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Group Spinner</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        @media (max-width: 1024px) {
            .container {
                grid-template-columns: 1fr;
            }
        }

        .header {
            grid-column: 1 / -1;
            text-align: center;
            margin-bottom: 20px;
            color: white;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .header h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        /* Wheel Container */
        .wheel-container {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .wheel-title {
            font-size: 1.8rem;
            color: #333;
            margin-bottom: 20px;
            text-align: center;
        }

        #wheel {
            width: 500px;
            height: 500px;
            position: relative;
            margin-bottom: 30px;
        }

        #wheel-canvas {
            width: 100%;
            height: 100%;
        }

        .wheel-center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 60px;
            height: 60px;
            background: #333;
            border-radius: 50%;
            z-index: 10;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.3);
        }

        .spin-button {
            background: linear-gradient(to right, #ff416c, #ff4b2b);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.3rem;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            letter-spacing: 1px;
            margin-top: 10px;
            box-shadow: 0 5px 15px rgba(255, 75, 43, 0.4);
        }

        .spin-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(255, 75, 43, 0.6);
        }

        .spin-button:active {
            transform: translateY(1px);
        }

        .spin-button:disabled {
            background: #cccccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* Dashboard Container */
        .dashboard-container {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
            display: flex;
            flex-direction: column;
        }

        .dashboard-title {
            font-size: 1.8rem;
            color: #333;
            margin-bottom: 20px;
            text-align: center;
        }

        .control-panel {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        @media (max-width: 768px) {
            .control-panel {
                grid-template-columns: 1fr;
            }
        }

        .control-group {
            display: flex;
            flex-direction: column;
        }

        .control-group label {
            font-weight: 600;
            margin-bottom: 8px;
            color: #555;
        }

        .control-group input, .control-group select {
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .control-group input:focus, .control-group select:focus {
            border-color: #6a11cb;
            outline: none;
        }

        /* File Upload */
        .file-upload-container {
            margin-bottom: 20px;
        }

        .file-upload-box {
            border: 2px dashed #ddd;
            border-radius: 10px;
            padding: 25px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: #f9f9f9;
        }

        .file-upload-box:hover {
            border-color: #6a11cb;
            background: #f0f0f0;
        }

        .file-upload-box.dragover {
            border-color: #6a11cb;
            background: #e8f4ff;
        }

        .file-upload-icon {
            font-size: 2.5rem;
            color: #6a11cb;
            margin-bottom: 10px;
        }

        .file-upload-text {
            margin-bottom: 10px;
            color: #555;
        }

        .file-upload-hint {
            font-size: 0.9rem;
            color: #888;
        }

        #file-input {
            display: none;
        }

        .upload-button {
            background: #6a11cb;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: background 0.3s;
            margin-top: 10px;
            display: inline-block;
        }

        .upload-button:hover {
            background: #5a0db3;
        }

        .student-list-container {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }

        .student-list-title {
            font-size: 1.5rem;
            color: #333;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        #student-list {
            list-style: none;
            max-height: 200px;
            overflow-y: auto;
            border: 2px solid #eee;
            border-radius: 10px;
            padding: 10px;
            margin-bottom: 20px;
            flex-grow: 1;
        }

        .student-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            background: #f9f9f9;
            border-radius: 8px;
            margin-bottom: 8px;
            transition: background 0.2s;
        }

        .student-item:hover {
            background: #f0f0f0;
        }

        .student-item:last-child {
            margin-bottom: 0;
        }

        .remove-student {
            background: #ff416c;
            color: white;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .student-input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .student-input-group input {
            flex-grow: 1;
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 1rem;
        }

        .add-student-btn {
            background: #2575fc;
            color: white;
            border: none;
            padding: 0 25px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            transition: background 0.3s;
        }

        .add-student-btn:hover {
            background: #1a68e8;
        }

        /* Results Section */
        .results-container {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
            margin-top: 30px;
            grid-column: 1 / -1;
        }

        .results-title {
            font-size: 1.8rem;
            color: #333;
            margin-bottom: 20px;
            text-align: center;
        }

        .groups-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 25px;
        }

        .group-card {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            border-left: 5px solid #6a11cb;
        }

        .group-card.uneven {
            border-left: 5px solid #ff416c;
            background: #fff5f5;
        }

        .group-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }

        .group-name {
            font-size: 1.4rem;
            font-weight: bold;
            color: #333;
        }

        .group-count {
            background: #6a11cb;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .uneven .group-count {
            background: #ff416c;
        }

        .group-members {
            list-style: none;
        }

        .group-member {
            padding: 10px 0;
            border-bottom: 1px dashed #eee;
            color: #555;
        }

        .group-member:last-child {
            border-bottom: none;
        }

        .empty-message {
            text-align: center;
            color: #888;
            font-style: italic;
            padding: 20px;
            grid-column: 1 / -1;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .secondary-button {
            background: #6c757d;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            transition: background 0.3s;
        }

        .secondary-button:hover {
            background: #5a6268;
        }

        /* Distribution Options */
        .distribution-options {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            border: 1px solid #eee;
        }

        .distribution-title {
            font-weight: 600;
            margin-bottom: 10px;
            color: #555;
            font-size: 1rem;
        }

        .distribution-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .distribute-btn {
            background: #e9ecef;
            border: 2px solid #dee2e6;
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
        }

        .distribute-btn:hover {
            background: #dee2e6;
        }

        .distribute-btn.active {
            background: #6a11cb;
            color: white;
            border-color: #6a11cb;
        }

        /* Wheel result indicator */
        .result-indicator {
            position: absolute;
            top: -30px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 20px solid transparent;
            border-right: 20px solid transparent;
            border-top: 30px solid #ff416c;
            z-index: 5;
        }

        /* Notification */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            background: #4CAF50;
            color: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            transform: translateX(150%);
            transition: transform 0.5s ease;
            z-index: 1000;
            font-weight: 500;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.error {
            background: #ff416c;
        }

        .notification.info {
            background: #2196F3;
        }

        /* File Preview */
        .file-preview {
            margin-top: 15px;
            padding: 15px;
            background: #f0f8ff;
            border-radius: 8px;
            border-left: 4px solid #2196F3;
        }

        .file-preview h4 {
            margin-bottom: 10px;
            color: #333;
        }

        .preview-count {
            font-weight: bold;
            color: #2196F3;
        }

        /* Responsive adjustments */
        @media (max-width: 1200px) {
            #wheel {
                width: 400px;
                height: 400px;
            }
        }

        @media (max-width: 900px) {
            #wheel {
                width: 350px;
                height: 350px;
            }
        }

        @media (max-width: 768px) {
            #wheel {
                width: 300px;
                height: 300px;
            }
            
            .header h1 {
                font-size: 2.2rem;
            }
            
            .action-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .secondary-button {
                width: 100%;
                max-width: 300px;
            }
        }
        
        /* User Guide */
        .help-link {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #6a11cb;
            color: white;
            padding: 12px 20px;
            border-radius: 50px;
            text-decoration: none;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 1000;
            transition: all 0.3s;
        }
    
        .help-link:hover {
            background: #5a0db3;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }
    
        .help-link-icon {
            font-size: 1.2rem;
        }

    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-users"></i> Student Group Spinner</h1>
            <p>Create random student groups with an interactive spinning wheel</p>
        </div>

        <div class="wheel-container">
            <h2 class="wheel-title">Group Spinner</h2>
            <div id="wheel">
                <div class="result-indicator"></div>
                <canvas id="wheel-canvas"></canvas>
                <div class="wheel-center">
                    <i class="fas fa-grip-lines"></i>
                </div>
            </div>
            <button id="spin-button" class="spin-button">
                <i class="fas fa-redo-alt"></i> Spin the Wheel
            </button>
        </div>

        <div class="dashboard-container">
            <h2 class="dashboard-title">Dashboard</h2>
            <!-- User Guide -->
            <div class="dashboard-title">                 
                <a href="README.md" target="_blank" style="margin-left: 10px; font-size: 0.8rem; color: #6a11cb; text-decoration: none;">
                    <i class="fas fa-question-circle"></i> Help
                </a>
            </div>
            
            <div class="control-panel">
                <div class="control-group">
                    <label for="group-size">Group Size</label>
                    <select id="group-size">
                        <option value="2">2 Students per Group</option>
                        <option value="3" selected>3 Students per Group</option>
                        <option value="4">4 Students per Group</option>
                        <option value="5">5 Students per Group</option>
                        <option value="6">6 Students per Group</option>
                        <option value="0">Custom (use group count)</option>
                    </select>
                </div>
                
                <div class="control-group">
                    <label for="group-count">Number of Groups</label>
                    <select id="group-count">
                        <option value="auto">Auto-calculate</option>
                        <option value="2">2 Groups</option>
                        <option value="3">3 Groups</option>
                        <option value="4">4 Groups</option>
                        <option value="5">5 Groups</option>
                        <option value="6">6 Groups</option>
                        <option value="7">7 Groups</option>
                        <option value="8">8 Groups</option>
                    </select>
                </div>
            </div>
            
            <div class="distribution-options">
                <div class="distribution-title">Uneven Distribution:</div>
                <div class="distribution-buttons">
                    <button id="distribute-evenly" class="distribute-btn active">Evenly Distribute</button>
                    <button id="distribute-first" class="distribute-btn">Fill First Groups</button>
                    <button id="distribute-last" class="distribute-btn">Fill Last Groups</button>
                </div>
            </div>
            
            <div class="file-upload-container">
                <div class="file-upload-box" id="drop-area">
                    <div class="file-upload-icon">
                        <i class="fas fa-cloud-upload-alt"></i>
                    </div>
                    <div class="file-upload-text">
                        <strong>Upload Student List</strong>
                    </div>
                    <div class="file-upload-hint">
                        Drag & drop a file or click to browse
                    </div>
                    <input type="file" id="file-input" accept=".txt,.csv,.xlsx,.xls">
                    <div class="upload-button" onclick="document.getElementById('file-input').click()">
                        <i class="fas fa-folder-open"></i> Browse Files
                    </div>
                </div>
                <div id="file-preview"></div>
            </div>
            
            <div class="student-list-container">
                <h3 class="student-list-title">
                    Student List
                    <span id="student-count">0 students</span>
                </h3>
                
                <div class="student-input-group">
                    <input type="text" id="student-input" placeholder="Enter student name">
                    <button id="add-student" class="add-student-btn">
                        <i class="fas fa-plus"></i> Add
                    </button>
                </div>
                
                <ul id="student-list">
                    <li class="empty-message">No students added yet. Add students above or upload a file.</li>
                </ul>
                
                <div class="action-buttons">
                    <button id="clear-students" class="secondary-button">
                        <i class="fas fa-trash"></i> Clear All
                    </button>
                    <button id="add-sample" class="secondary-button">
                        <i class="fas fa-vial"></i> Add Sample Students
                    </button>
                </div>
            </div>
        </div>

        <div class="results-container">
            <h2 class="results-title">Generated Groups</h2>
            <div id="groups-container" class="groups-container">
                <div class="empty-message">Spin the wheel to generate groups</div>
            </div>
            <div class="action-buttons">
                <button id="export-groups" class="secondary-button">
                    <i class="fas fa-download"></i> Export Groups
                </button>
                <button id="export-students" class="secondary-button">
                    <i class="fas fa-file-export"></i> Export Student List
                </button>
                <button id="reset-groups" class="secondary-button">
                    <i class="fas fa-undo"></i> Reset Groups
                </button>
            </div>
        </div>
    </div>

    <div id="notification" class="notification"></div>

    <script>
        // Application State
        const state = {
            students: [],
            groups: [],
            wheelSpinning: false,
            wheelSegments: [],
            colors: [
                '#FF6B6B', '#4ECDC4', '#FFD166', '#06D6A0', 
                '#118AB2', '#EF476F', '#073B4C', '#7209B7',
                '#3A86FF', '#FB5607', '#8338EC', '#FF006E'
            ],
            distributionMethod: 'evenly' // 'evenly', 'first', 'last'
        };

        // DOM Elements
        const wheelCanvas = document.getElementById('wheel-canvas');
        const spinButton = document.getElementById('spin-button');
        const studentInput = document.getElementById('student-input');
        const addStudentBtn = document.getElementById('add-student');
        const studentList = document.getElementById('student-list');
        const studentCount = document.getElementById('student-count');
        const clearStudentsBtn = document.getElementById('clear-students');
        const addSampleBtn = document.getElementById('add-sample');
        const groupSizeSelect = document.getElementById('group-size');
        const groupCountSelect = document.getElementById('group-count');
        const groupsContainer = document.getElementById('groups-container');
        const exportGroupsBtn = document.getElementById('export-groups');
        const exportStudentsBtn = document.getElementById('export-students');
        const resetGroupsBtn = document.getElementById('reset-groups');
        const notification = document.getElementById('notification');
        const fileInput = document.getElementById('file-input');
        const dropArea = document.getElementById('drop-area');
        const filePreview = document.getElementById('file-preview');
        
        // Distribution buttons
        const distributeEvenlyBtn = document.getElementById('distribute-evenly');
        const distributeFirstBtn = document.getElementById('distribute-first');
        const distributeLastBtn = document.getElementById('distribute-last');

        // Wheel variables
        const ctx = wheelCanvas.getContext('2d');
        let wheelRadius = 0;
        let currentRotation = 0;
        let spinAnimation = null;

        // Initialize the application
        function init() {
            // Set up event listeners
            addStudentBtn.addEventListener('click', addStudent);
            studentInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') addStudent();
            });
            
            clearStudentsBtn.addEventListener('click', clearStudents);
            addSampleBtn.addEventListener('click', addSampleStudents);
            spinButton.addEventListener('click', spinWheel);
            exportGroupsBtn.addEventListener('click', exportGroups);
            exportStudentsBtn.addEventListener('click', exportStudentList);
            resetGroupsBtn.addEventListener('click', resetGroups);
            
            // File upload events
            fileInput.addEventListener('change', handleFileSelect);
            setupDragAndDrop();
            
            // Distribution method events
            distributeEvenlyBtn.addEventListener('click', () => setDistributionMethod('evenly'));
            distributeFirstBtn.addEventListener('click', () => setDistributionMethod('first'));
            distributeLastBtn.addEventListener('click', () => setDistributionMethod('last'));
            
            // Load any saved data from localStorage
            loadFromLocalStorage();
            
            // Set canvas size
            updateCanvasSize();
            window.addEventListener('resize', updateCanvasSize);
            
            // Draw initial wheel
            drawWheel();
        }

        // Set distribution method
        function setDistributionMethod(method) {
            state.distributionMethod = method;
            
            // Update active button
            distributeEvenlyBtn.classList.remove('active');
            distributeFirstBtn.classList.remove('active');
            distributeLastBtn.classList.remove('active');
            
            if (method === 'evenly') {
                distributeEvenlyBtn.classList.add('active');
            } else if (method === 'first') {
                distributeFirstBtn.classList.add('active');
            } else if (method === 'last') {
                distributeLastBtn.classList.add('active');
            }
            
            saveToLocalStorage();
        }

        // Set up drag and drop
        function setupDragAndDrop() {
            // Prevent default drag behaviors
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                dropArea.addEventListener(eventName, preventDefaults, false);
                document.body.addEventListener(eventName, preventDefaults, false);
            });
            
            // Highlight drop area when item is dragged over it
            ['dragenter', 'dragover'].forEach(eventName => {
                dropArea.addEventListener(eventName, highlight, false);
            });
            
            ['dragleave', 'drop'].forEach(eventName => {
                dropArea.addEventListener(eventName, unhighlight, false);
            });
            
            // Handle dropped files
            dropArea.addEventListener('drop', handleDrop, false);
            
            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }
            
            function highlight() {
                dropArea.classList.add('dragover');
            }
            
            function unhighlight() {
                dropArea.classList.remove('dragover');
            }
            
            function handleDrop(e) {
                const dt = e.dataTransfer;
                const files = dt.files;
                
                if (files.length > 0) {
                    handleFile(files[0]);
                }
            }
        }

        // Handle file selection
        function handleFileSelect(e) {
            const files = e.target.files;
            if (files.length > 0) {
                handleFile(files[0]);
            }
        }

        // Process uploaded file
        function handleFile(file) {
            if (!file) return;
            
            const fileType = file.name.split('.').pop().toLowerCase();
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    let students = [];
                    
                    if (fileType === 'txt' || fileType === 'csv') {
                        // Process text or CSV file
                        const content = e.target.result;
                        students = parseTextFile(content);
                    } else if (fileType === 'xlsx' || fileType === 'xls') {
                        // Process Excel file (simplified - in real app you'd need a library like SheetJS)
                        showNotification('Excel files require additional libraries. Please use TXT or CSV files.', 'error');
                        return;
                    } else {
                        showNotification('Unsupported file type. Please upload TXT or CSV files.', 'error');
                        return;
                    }
                    
                    // Add students to list
                    addStudentsFromFile(students);
                    
                } catch (error) {
                    console.error('Error processing file:', error);
                    showNotification('Error processing file. Please check the file format.', 'error');
                }
            };
            
            reader.onerror = function() {
                showNotification('Error reading file', 'error');
            };
            
            if (fileType === 'txt' || fileType === 'csv') {
                reader.readAsText(file);
            } else {
                // For other file types, read as binary
                reader.readAsBinaryString(file);
            }
            
            // Show file preview
            showFilePreview(file);
        }

        // Parse text file content
        function parseTextFile(content) {
            const students = [];
            const lines = content.split('\n');
            
            for (let line of lines) {
                // Remove carriage returns and trim whitespace
                line = line.replace(/\r/g, '').trim();
                
                // Skip empty lines
                if (!line) continue;
                
                // Handle CSV format (comma separated)
                if (line.includes(',')) {
                    const parts = line.split(',');
                    for (let part of parts) {
                        const name = part.trim();
                        if (name && !students.includes(name)) {
                            students.push(name);
                        }
                    }
                } else {
                    // Handle line-by-line format
                    if (!students.includes(line)) {
                        students.push(line);
                    }
                }
            }
            
            return students;
        }

        // Add students from file
        function addStudentsFromFile(students) {
            if (!students || students.length === 0) {
                showNotification('No valid student names found in the file', 'error');
                return;
            }
            
            // Add students that aren't already in the list
            let addedCount = 0;
            for (let student of students) {
                if (student && !state.students.includes(student)) {
                    state.students.push(student);
                    addedCount++;
                }
            }
            
            updateStudentList();
            drawWheel();
            saveToLocalStorage();
            
            showNotification(`Added ${addedCount} students from file`);
        }

        // Show file preview
        function showFilePreview(file) {
            if (!file) return;
            
            const fileSize = (file.size / 1024).toFixed(2);
            
            filePreview.innerHTML = `
                <h4>File Preview</h4>
                <p><strong>File Name:</strong> ${file.name}</p>
                <p><strong>File Size:</strong> ${fileSize} KB</p>
                <p><strong>Type:</strong> ${file.type || 'Unknown'}</p>
                <p><span class="preview-count">${state.students.length}</span> students in list</p>
            `;
        }

        // Update canvas size based on container
        function updateCanvasSize() {
            const wheelContainer = document.getElementById('wheel');
            const size = Math.min(wheelContainer.offsetWidth, 500);
            
            wheelCanvas.width = size;
            wheelCanvas.height = size;
            wheelRadius = size / 2;
            
            drawWheel();
        }

        // Draw the wheel
        function drawWheel() {
            // Clear canvas
            ctx.clearRect(0, 0, wheelCanvas.width, wheelCanvas.height);
            
            // If no students, draw empty wheel
            if (state.students.length === 0) {
                drawEmptyWheel();
                return;
            }
            
            // Calculate segment angle
            const segmentAngle = (2 * Math.PI) / state.students.length;
            
            // Reset wheel segments
            state.wheelSegments = [];
            
            // Draw each segment
            for (let i = 0; i < state.students.length; i++) {
                const startAngle = i * segmentAngle + currentRotation;
                const endAngle = (i + 1) * segmentAngle + currentRotation;
                
                // Save segment data for spinning
                state.wheelSegments.push({
                    startAngle,
                    endAngle,
                    student: state.students[i]
                });
                
                // Draw segment
                ctx.beginPath();
                ctx.moveTo(wheelRadius, wheelRadius);
                ctx.arc(wheelRadius, wheelRadius, wheelRadius, startAngle, endAngle);
                ctx.closePath();
                
                // Fill with color
                ctx.fillStyle = state.colors[i % state.colors.length];
                ctx.fill();
                
                // Draw segment border
                ctx.strokeStyle = 'white';
                ctx.lineWidth = 2;
                ctx.stroke();
                
                // Draw student name
                ctx.save();
                ctx.translate(wheelRadius, wheelRadius);
                ctx.rotate(startAngle + segmentAngle / 2);
                ctx.textAlign = 'right';
                ctx.fillStyle = 'white';
                ctx.font = `bold ${Math.max(14, wheelRadius / 15)}px Segoe UI`;
                
                // Truncate long names
                let displayName = state.students[i];
                if (displayName.length > 15) {
                    displayName = displayName.substring(0, 12) + '...';
                }
                
                ctx.fillText(displayName, wheelRadius - 20, 5);
                ctx.restore();
            }
            
            // Draw center circle
            ctx.beginPath();
            ctx.arc(wheelRadius, wheelRadius, 15, 0, 2 * Math.PI);
            ctx.fillStyle = '#333';
            ctx.fill();
            ctx.strokeStyle = 'white';
            ctx.lineWidth = 3;
            ctx.stroke();
        }

        // Draw empty wheel
        function drawEmptyWheel() {
            ctx.beginPath();
            ctx.arc(wheelRadius, wheelRadius, wheelRadius, 0, 2 * Math.PI);
            ctx.fillStyle = '#f0f0f0';
            ctx.fill();
            ctx.strokeStyle = '#ddd';
            ctx.lineWidth = 3;
            ctx.stroke();
            
            // Draw "Add Students" text
            ctx.fillStyle = '#aaa';
            ctx.font = `bold ${wheelRadius / 10}px Segoe UI`;
            ctx.textAlign = 'center';
            ctx.fillText('Add students to begin', wheelRadius, wheelRadius);
            
            // Draw center circle
            ctx.beginPath();
            ctx.arc(wheelRadius, wheelRadius, 15, 0, 2 * Math.PI);
            ctx.fillStyle = '#ccc';
            ctx.fill();
        }

        // Spin the wheel
        function spinWheel() {
            if (state.wheelSpinning || state.students.length === 0) return;
            
            // Calculate group configuration
            const groupSize = parseInt(groupSizeSelect.value);
            const groupCountValue = groupCountSelect.value;
            
            let groupCount;
            if (groupCountValue === 'auto') {
                if (groupSize === 0) {
                    groupCount = Math.ceil(state.students.length / 3); // Default to groups of 3
                } else {
                    groupCount = Math.ceil(state.students.length / groupSize);
                }
            } else {
                groupCount = parseInt(groupCountValue);
            }
            
            // Validate we have enough students
            if (state.students.length < groupCount) {
                showNotification(`Not enough students. Need at least ${groupCount} students for ${groupCount} groups.`, 'error');
                return;
            }
            
            // Disable spin button
            state.wheelSpinning = true;
            spinButton.disabled = true;
            spinButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Spinning...';
            
            // Create groups based on distribution method
            createGroups(groupCount);
            
            // Calculate spin parameters
            const spinDuration = 3000; // 3 seconds
            const spinCycles = 5; // 5 full rotations
            const finalRotation = spinCycles * 2 * Math.PI + Math.random() * 2 * Math.PI;
            
            // Animate the spin
            let startTime = null;
            
            function animateSpin(timestamp) {
                if (!startTime) startTime = timestamp;
                const elapsed = timestamp - startTime;
                const progress = Math.min(elapsed / spinDuration, 1);
                
                // Easing function for smooth deceleration
                const easeOut = 1 - Math.pow(1 - progress, 3);
                
                // Update rotation
                currentRotation = easeOut * finalRotation;
                drawWheel();
                
                if (progress < 1) {
                    spinAnimation = requestAnimationFrame(animateSpin);
                } else {
                    // Spin complete
                    state.wheelSpinning = false;
                    spinButton.disabled = false;
                    spinButton.innerHTML = '<i class="fas fa-redo-alt"></i> Spin the Wheel';
                    
                    // Display groups
                    displayGroups();
                    
                    // Save to localStorage
                    saveToLocalStorage();
                    
                    // Show notification
                    showNotification(`Created ${state.groups.length} groups successfully!`);
                }
            }
            
            spinAnimation = requestAnimationFrame(animateSpin);
        }

        // Create groups based on distribution method
        function createGroups(groupCount) {
            // Create a copy of students and shuffle
            const shuffledStudents = [...state.students];
            shuffleArray(shuffledStudents);
            
            // Initialize groups
            state.groups = Array.from({ length: groupCount }, () => []);
            
            // Calculate ideal group size
            const idealGroupSize = Math.floor(shuffledStudents.length / groupCount);
            const remainder = shuffledStudents.length % groupCount;
            
            // Distribute students based on selected method
            if (state.distributionMethod === 'evenly') {
                distributeEvenly(shuffledStudents, groupCount, idealGroupSize, remainder);
            } else if (state.distributionMethod === 'first') {
                distributeToFirstGroups(shuffledStudents, groupCount, idealGroupSize, remainder);
            } else if (state.distributionMethod === 'last') {
                distributeToLastGroups(shuffledStudents, groupCount, idealGroupSize, remainder);
            }
            
            // Remove empty groups if any
            state.groups = state.groups.filter(group => group.length > 0);
        }

        // Distribute students evenly
        function distributeEvenly(students, groupCount, idealSize, remainder) {
            let studentIndex = 0;
            
            // First pass: distribute ideal size to all groups
            for (let i = 0; i < groupCount; i++) {
                for (let j = 0; j < idealSize; j++) {
                    if (studentIndex < students.length) {
                        state.groups[i].push(students[studentIndex]);
                        studentIndex++;
                    }
                }
            }
            
            // Second pass: distribute remainder to first 'remainder' groups
            for (let i = 0; i < remainder; i++) {
                if (studentIndex < students.length) {
                    state.groups[i].push(students[studentIndex]);
                    studentIndex++;
                }
            }
        }

        // Distribute extra students to first groups
        function distributeToFirstGroups(students, groupCount, idealSize, remainder) {
            let studentIndex = 0;
            
            // Calculate sizes for each group
            const groupSizes = Array(groupCount).fill(idealSize);
            
            // Add remainder to first groups
            for (let i = 0; i < remainder; i++) {
                groupSizes[i]++;
            }
            
            // Distribute students according to group sizes
            for (let i = 0; i < groupCount; i++) {
                for (let j = 0; j < groupSizes[i]; j++) {
                    if (studentIndex < students.length) {
                        state.groups[i].push(students[studentIndex]);
                        studentIndex++;
                    }
                }
            }
        }

        // Distribute extra students to last groups
        function distributeToLastGroups(students, groupCount, idealSize, remainder) {
            let studentIndex = 0;
            
            // Calculate sizes for each group
            const groupSizes = Array(groupCount).fill(idealSize);
            
            // Add remainder to last groups
            for (let i = groupCount - 1; i >= groupCount - remainder; i--) {
                groupSizes[i]++;
            }
            
            // Distribute students according to group sizes
            for (let i = 0; i < groupCount; i++) {
                for (let j = 0; j < groupSizes[i]; j++) {
                    if (studentIndex < students.length) {
                        state.groups[i].push(students[studentIndex]);
                        studentIndex++;
                    }
                }
            }
        }

        // Display groups in the results section
        function displayGroups() {
            if (state.groups.length === 0) {
                groupsContainer.innerHTML = '<div class="empty-message">Spin the wheel to generate groups</div>';
                return;
            }
            
            // Calculate group sizes to identify uneven groups
            const groupSizes = state.groups.map(group => group.length);
            const minSize = Math.min(...groupSizes);
            const maxSize = Math.max(...groupSizes);
            const hasUnevenGroups = minSize !== maxSize;
            
            let groupsHTML = '';
            
            state.groups.forEach((group, index) => {
                const isUneven = group.length !== minSize && hasUnevenGroups;
                
                let membersHTML = '';
                group.forEach(member => {
                    membersHTML += `<li class="group-member">${member}</li>`;
                });
                
                groupsHTML += `
                    <div class="group-card ${isUneven ? 'uneven' : ''}">
                        <div class="group-header">
                            <div class="group-name">Group ${index + 1}</div>
                            <div class="group-count">${group.length}</div>
                        </div>
                        <ul class="group-members">
                            ${membersHTML}
                        </ul>
                    </div>
                `;
            });
            
            // Add distribution info if groups are uneven
            if (hasUnevenGroups) {
                const extraStudents = maxSize - minSize;
                groupsHTML += `
                    <div class="empty-message" style="grid-column: 1 / -1; text-align: left; background: #fff5f5; border-radius: 10px;">
                        <p><strong>Note:</strong> Groups are uneven due to student count.</p>
                        <p>Some groups have ${extraStudents} extra student(s).</p>
                        <p>Distribution method: <strong>${state.distributionMethod}</strong></p>
                    </div>
                `;
            }
            
            groupsContainer.innerHTML = groupsHTML;
        }

        // Add a student
        function addStudent() {
            const name = studentInput.value.trim();
            
            if (name === '') {
                showNotification('Please enter a student name', 'error');
                return;
            }
            
            if (state.students.includes(name)) {
                showNotification('This student is already in the list', 'error');
                return;
            }
            
            state.students.push(name);
            studentInput.value = '';
            updateStudentList();
            drawWheel();
            saveToLocalStorage();
            
            showNotification(`Added student: ${name}`);
        }

        // Update the student list display
        function updateStudentList() {
            studentCount.textContent = `${state.students.length} students`;
            
            // Update file preview if it exists
            if (filePreview.innerHTML) {
                const previewElement = filePreview.querySelector('.preview-count');
                if (previewElement) {
                    previewElement.textContent = state.students.length;
                }
            }
            
            if (state.students.length === 0) {
                studentList.innerHTML = '<li class="empty-message">No students added yet. Add students above or upload a file.</li>';
                return;
            }
            
            let studentsHTML = '';
            
            state.students.forEach((student, index) => {
                studentsHTML += `
                    <li class="student-item">
                        <span>${student}</span>
                        <button class="remove-student" data-index="${index}">
                            <i class="fas fa-times"></i>
                        </button>
                    </li>
                `;
            });
            
            studentList.innerHTML = studentsHTML;
            
            // Add event listeners to remove buttons
            document.querySelectorAll('.remove-student').forEach(button => {
                button.addEventListener('click', function() {
                    const index = parseInt(this.getAttribute('data-index'));
                    removeStudent(index);
                });
            });
        }

        // Remove a student
        function removeStudent(index) {
            const removedStudent = state.students[index];
            state.students.splice(index, 1);
            updateStudentList();
            drawWheel();
            saveToLocalStorage();
            
            showNotification(`Removed student: ${removedStudent}`);
        }

        // Clear all students
        function clearStudents() {
            if (state.students.length === 0) return;
            
            if (confirm(`Are you sure you want to remove all ${state.students.length} students?`)) {
                state.students = [];
                updateStudentList();
                drawWheel();
                saveToLocalStorage();
                
                // Clear file preview
                filePreview.innerHTML = '';
                
                showNotification('All students removed');
            }
        }

        // Add sample students
        function addSampleStudents() {
            const sampleStudents = [
                'Alex Johnson', 'Maria Garcia', 'David Chen', 'Sarah Williams',
                'James Miller', 'Emma Davis', 'Michael Brown', 'Olivia Wilson',
                'Daniel Taylor', 'Sophia Martinez', 'Robert Anderson', 'Isabella Thomas',
                'William Jackson', 'Mia White', 'Joseph Harris', 'Charlotte Martin'
            ];
            
            // Only add students that aren't already in the list
            sampleStudents.forEach(student => {
                if (!state.students.includes(student)) {
                    state.students.push(student);
                }
            });
            
            updateStudentList();
            drawWheel();
            saveToLocalStorage();
            
            showNotification(`Added ${sampleStudents.length} sample students`);
        }

        // Export groups
        function exportGroups() {
            if (state.groups.length === 0) {
                showNotification('No groups to export. Spin the wheel first.', 'error');
                return;
            }
            
            let exportText = 'STUDENT GROUPS\n';
            exportText += `Generated on: ${new Date().toLocaleDateString()} ${new Date().toLocaleTimeString()}\n`;
            exportText += `Total Students: ${state.students.length}\n`;
            exportText += `Number of Groups: ${state.groups.length}\n`;
            exportText += `Distribution Method: ${state.distributionMethod}\n`;
            exportText += `Group Configuration: ${groupSizeSelect.value === '0' ? 'Custom' : groupSizeSelect.value} students per group\n\n`;
            
            state.groups.forEach((group, index) => {
                const groupSize = group.length;
                const minSize = Math.min(...state.groups.map(g => g.length));
                const isUneven = groupSize !== minSize;
                
                exportText += `GROUP ${index + 1} (${groupSize} student${groupSize !== 1 ? 's' : ''})${isUneven ? ' [UNEVEN]' : ''}:\n`;
                group.forEach(student => {
                    exportText += `   ${student}\n`;
                });
                exportText += '\n';
            });
            
            // Add summary
            const groupSizes = state.groups.map(group => group.length);
            const minSize = Math.min(...groupSizes);
            const maxSize = Math.max(...groupSizes);
            
            if (minSize !== maxSize) {
                exportText += `SUMMARY:\n`;
                exportText += `  - Smallest group: ${minSize} students\n`;
                exportText += `  - Largest group: ${maxSize} students\n`;
                exportText += `  - Extra students in some groups: ${maxSize - minSize}\n`;
            }
            
            // Create download link
            const blob = new Blob([exportText], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            const dateStr = new Date().toISOString().slice(0, 10);
            a.download = `student-groups-${dateStr}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('Groups exported successfully');
        }

        // Export student list
        function exportStudentList() {
            if (state.students.length === 0) {
                showNotification('No students to export', 'error');
                return;
            }
            
            let exportText = 'STUDENT LIST\n';
            exportText += `Exported on: ${new Date().toLocaleDateString()} ${new Date().toLocaleTimeString()}\n`;
            exportText += `Total Students: ${state.students.length}\n\n`;
            
            state.students.forEach((student, index) => {
                exportText += `${index + 1}. ${student}\n`;
            });
            
            // Create download link
            const blob = new Blob([exportText], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            const dateStr = new Date().toISOString().slice(0, 10);
            a.download = `student-list-${dateStr}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('Student list exported successfully');
        }

        // Reset groups
        function resetGroups() {
            if (state.groups.length === 0) return;
            
            if (confirm('Are you sure you want to reset all groups?')) {
                state.groups = [];
                displayGroups();
                showNotification('Groups reset successfully');
            }
        }

        // Show notification
        function showNotification(message, type = 'success') {
            notification.textContent = message;
            notification.className = 'notification';
            
            if (type === 'error') {
                notification.classList.add('error');
            } else if (type === 'info') {
                notification.classList.add('info');
            }
            
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // Utility function to shuffle array
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Save data to localStorage
        function saveToLocalStorage() {
            const data = {
                students: state.students,
                groups: state.groups,
                groupSize: groupSizeSelect.value,
                groupCount: groupCountSelect.value,
                distributionMethod: state.distributionMethod
            };
            
            localStorage.setItem('studentGroupSpinner', JSON.stringify(data));
        }

        // Load data from localStorage
        function loadFromLocalStorage() {
            const savedData = localStorage.getItem('studentGroupSpinner');
            
            if (savedData) {
                try {
                    const data = JSON.parse(savedData);
                    state.students = data.students || [];
                    state.groups = data.groups || [];
                    
                    if (data.groupSize) groupSizeSelect.value = data.groupSize;
                    if (data.groupCount) groupCountSelect.value = data.groupCount;
                    if (data.distributionMethod) setDistributionMethod(data.distributionMethod);
                    
                    updateStudentList();
                    displayGroups();
                    
                    if (state.students.length > 0) {
                        showNotification(`Loaded ${state.students.length} students from previous session`, 'info');
                    }
                } catch (e) {
                    console.error('Error loading saved data:', e);
                }
            }
        }

        // Initialize the app
        window.addEventListener('DOMContentLoaded', init);
    </script>
    
    <!-- User Guide Float Aside -->
    <a href="README.md" target="_blank" class="help-link">
        <i class="fas fa-book help-link-icon"></i>
        <span>User Guide</span>
    </a>
</body>

</html>
