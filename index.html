<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Group Spinner</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="index.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-users"></i> Student Group Spinner</h1>
            <p>Create random student groups with an interactive spinning wheel</p>
            <div class="header-links">
                <a href="README.md" target="_blank" class="header-link">
                    <i class="fas fa-book"></i> User Guide
                </a>
                <a href="readme.html" target="_self" class="header-link">
                    <i class="fas fa-book"></i> User Guide
                </a>
                <a href="#" id="about-link" class="header-link">
                    <i class="fas fa-user"></i> About Creator
                </a>
            </div>
        </div>

        <div class="wheel-container">
            <h2 class="wheel-title">Group Spinner</h2>
            <div id="wheel">
                <div class="result-indicator"></div>
                <canvas id="wheel-canvas"></canvas>
                <div class="wheel-center">
                    <i class="fas fa-grip-lines"></i>
                </div>
            </div>
            <button id="spin-button" class="spin-button">
                <i class="fas fa-redo-alt"></i> Spin the Wheel
            </button>
        </div>

        <div class="dashboard-container">
            <h2 class="dashboard-title">Dashboard</h2>
            
            <div class="control-panel">
                <div class="control-group">
                    <label for="group-size">Group Size</label>
                    <select id="group-size">
                        <option value="2">2 Students per Group</option>
                        <option value="3" selected>3 Students per Group</option>
                        <option value="4">4 Students per Group</option>
                        <option value="5">5 Students per Group</option>
                        <option value="6">6 Students per Group</option>
                        <option value="0">Custom (use group count)</option>
                    </select>
                </div>
                
                <div class="control-group">
                    <label for="group-count">Number of Groups</label>
                    <select id="group-count">
                        <option value="auto">Auto-calculate</option>
                        <option value="2">2 Groups</option>
                        <option value="3">3 Groups</option>
                        <option value="4">4 Groups</option>
                        <option value="5">5 Groups</option>
                        <option value="6">6 Groups</option>
                        <option value="7">7 Groups</option>
                        <option value="8">8 Groups</option>
                    </select>
                </div>
            </div>
            
            <div class="distribution-options">
                <div class="distribution-title">Uneven Distribution:</div>
                <div class="distribution-buttons">
                    <button id="distribute-evenly" class="distribute-btn active">Evenly Distribute</button>
                    <button id="distribute-first" class="distribute-btn">Fill First Groups</button>
                    <button id="distribute-last" class="distribute-btn">Fill Last Groups</button>
                </div>
            </div>
            
            <div class="file-upload-container">
                <div class="file-upload-box" id="drop-area">
                    <div class="file-upload-icon">
                        <i class="fas fa-cloud-upload-alt"></i>
                    </div>
                    <div class="file-upload-text">
                        <strong>Upload Student List</strong>
                    </div>
                    <div class="file-upload-hint">
                        Drag & drop a file or click to browse
                    </div>
                    <input type="file" id="file-input" accept=".txt,.csv,.xlsx,.xls">
                    <div class="upload-button" onclick="document.getElementById('file-input').click()">
                        <i class="fas fa-folder-open"></i> Browse Files
                    </div>
                </div>
                <div id="file-preview"></div>
            </div>
            
            <div class="student-list-container">
                <h3 class="student-list-title">
                    Student List
                    <span id="student-count">0 students</span>
                </h3>
                
                <div class="student-input-group">
                    <input type="text" id="student-input" placeholder="Enter student name">
                    <button id="add-student" class="add-student-btn">
                        <i class="fas fa-plus"></i> Add
                    </button>
                </div>
                
                <ul id="student-list">
                    <li class="empty-message">No students added yet. Add students above or upload a file.</li>
                </ul>
                
                <div class="action-buttons">
                    <button id="clear-students" class="secondary-button">
                        <i class="fas fa-trash"></i> Clear All
                    </button>
                    <button id="add-sample" class="secondary-button">
                        <i class="fas fa-vial"></i> Add Sample Students
                    </button>
                </div>
            </div>
        </div>

        <div class="results-container">
            <h2 class="results-title">Generated Groups</h2>
            <div id="groups-container" class="groups-container">
                <div class="empty-message">Spin the wheel to generate groups</div>
            </div>
            <div class="action-buttons">
                <button id="export-groups" class="secondary-button">
                    <i class="fas fa-download"></i> Export Groups
                </button>
                <button id="export-students" class="secondary-button">
                    <i class="fas fa-file-export"></i> Export Student List
                </button>
                <button id="reset-groups" class="secondary-button">
                    <i class="fas fa-undo"></i> Reset Groups
                </button>
            </div>
        </div>

        <div class="help-section">
            <p style="margin-bottom: 10px;">
                <i class="fas fa-info-circle"></i> Need help using this application?
            </p>
            <a href="README.md" target="_blank" 
               style="color: white; text-decoration: none; background: rgba(255, 255, 255, 0.2); padding: 8px 20px; border-radius: 5px; display: inline-block; transition: background 0.3s;">
               <i class="fas fa-book"></i> View Complete User Guide
            </a>
            <a href="readme.html" target="_self" 
               style="color: white; text-decoration: none; background: rgba(255, 255, 255, 0.2); padding: 8px 20px; border-radius: 5px; display: inline-block; transition: background 0.3s;">
               <i class="fas fa-book"></i> View Complete User Guide
            </a>

            <a href="individual-task.html" target="_blank" 
               style="color: white; text-decoration: none; background: rgba(255, 255, 255, 0.2); padding: 8px 20px; border-radius: 5px; display: inline-block; transition: background 0.3s;">
               <i class="fas fa-book"></i> An individual task spinning wheel guide
            </a>
        </div>

    </div>

    <!-- About Me Modal -->
    <div id="about-modal" class="about-modal">
        <div class="about-content">
            <button class="close-about">&times;</button>
            
            <div class="profile-section">
                <!-- Replace with your actual image -->
                <img src="profile.jpg" alt="Developer" class="profile-picture" 
                     onerror="this.src='Sometri.jpg'">
                <h2 class="profile-name">Oeng Sometri</h2>
                <p class="profile-title">Web Developer & Educator</p>
            </div>
            
            <div class="about-text">
                <p>Hello! I'm passionate about creating educational tools that make teaching more effective and engaging.</p>
                <p>This Student Group Spinner was designed to help educators create fair, random groups quickly and easily.</p>
                <p>Feel free to reach out if you have suggestions or feedback!</p>
            </div>
            
            <div class="contact-links">
                <a href="https://github.com/sometri" target="_blank" class="contact-link github" title="GitHub">
                    <i class="fab fa-github"></i>
                </a>
                <a href="https://linkedin.com/in/sometri" target="_blank" class="contact-link linkedin" title="LinkedIn">
                    <i class="fab fa-linkedin-in"></i>
                </a>
                <a href="mailto:sometri.lecture@gmail.com.com" class="contact-link email" title="Email">
                    <i class="fas fa-envelope"></i>
                </a>
            </div>
        </div>
    </div>

    <!-- Floating Help Links -->
    <!-- <a href="README.md" target="_blank" class="help-link">
        <i class="fas fa-question-circle"></i>
        <span>User Guide</span>
    </a> -->
    <a href="readme.html" target="_self" class="help-link">
        <i class="fas fa-question-circle"></i>
        <span>User Guide</span>
    </a>
    
    <a href="#" id="about-help-link" class="help-link about">
        <i class="fas fa-user"></i>
        <span>About Creator</span>
    </a>

    <!-- Notification -->
    <div id="notification" class="notification"></div>

    <script>
        // Application State
        const state = {
            students: [],
            groups: [],
            wheelSpinning: false,
            wheelSegments: [],
            colors: [
                '#FF6B6B', '#4ECDC4', '#FFD166', '#06D6A0', 
                '#118AB2', '#EF476F', '#073B4C', '#7209B7',
                '#3A86FF', '#FB5607', '#8338EC', '#FF006E'
            ],
            distributionMethod: 'evenly' // 'evenly', 'first', 'last'
        };

        // DOM Elements
        const wheelCanvas = document.getElementById('wheel-canvas');
        const spinButton = document.getElementById('spin-button');
        const studentInput = document.getElementById('student-input');
        const addStudentBtn = document.getElementById('add-student');
        const studentList = document.getElementById('student-list');
        const studentCount = document.getElementById('student-count');
        const clearStudentsBtn = document.getElementById('clear-students');
        const addSampleBtn = document.getElementById('add-sample');
        const groupSizeSelect = document.getElementById('group-size');
        const groupCountSelect = document.getElementById('group-count');
        const groupsContainer = document.getElementById('groups-container');
        const exportGroupsBtn = document.getElementById('export-groups');
        const exportStudentsBtn = document.getElementById('export-students');
        const resetGroupsBtn = document.getElementById('reset-groups');
        const notification = document.getElementById('notification');
        const fileInput = document.getElementById('file-input');
        const dropArea = document.getElementById('drop-area');
        const filePreview = document.getElementById('file-preview');
        
        // Distribution buttons
        const distributeEvenlyBtn = document.getElementById('distribute-evenly');
        const distributeFirstBtn = document.getElementById('distribute-first');
        const distributeLastBtn = document.getElementById('distribute-last');
        
        // About modal elements
        const aboutLink = document.getElementById('about-link');
        const aboutHelpLink = document.getElementById('about-help-link');
        const aboutModal = document.getElementById('about-modal');
        const closeAbout = document.querySelector('.close-about');

        // Wheel variables
        const ctx = wheelCanvas.getContext('2d');
        let wheelRadius = 0;
        let currentRotation = 0;
        let spinAnimation = null;

        // Initialize the application
        function init() {
            // Set up event listeners
            addStudentBtn.addEventListener('click', addStudent);
            studentInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') addStudent();
            });
            
            clearStudentsBtn.addEventListener('click', clearStudents);
            addSampleBtn.addEventListener('click', addSampleStudents);
            spinButton.addEventListener('click', spinWheel);
            exportGroupsBtn.addEventListener('click', exportGroups);
            exportStudentsBtn.addEventListener('click', exportStudentList);
            resetGroupsBtn.addEventListener('click', resetGroups);
            
            // File upload events
            fileInput.addEventListener('change', handleFileSelect);
            setupDragAndDrop();
            
            // Distribution method events
            distributeEvenlyBtn.addEventListener('click', () => setDistributionMethod('evenly'));
            distributeFirstBtn.addEventListener('click', () => setDistributionMethod('first'));
            distributeLastBtn.addEventListener('click', () => setDistributionMethod('last'));
            
            // About modal events
            aboutLink.addEventListener('click', (e) => {
                e.preventDefault();
                aboutModal.classList.add('active');
            });
            
            aboutHelpLink.addEventListener('click', (e) => {
                e.preventDefault();
                aboutModal.classList.add('active');
            });
            
            closeAbout.addEventListener('click', () => {
                aboutModal.classList.remove('active');
            });
            
            aboutModal.addEventListener('click', (e) => {
                if (e.target === aboutModal) {
                    aboutModal.classList.remove('active');
                }
            });
            
            // Close modal with ESC key
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && aboutModal.classList.contains('active')) {
                    aboutModal.classList.remove('active');
                }
            });
            
            // Load any saved data from localStorage
            loadFromLocalStorage();
            
            // Set canvas size
            updateCanvasSize();
            window.addEventListener('resize', updateCanvasSize);
            
            // Draw initial wheel
            drawWheel();
        }

        // Set distribution method
        function setDistributionMethod(method) {
            state.distributionMethod = method;
            
            // Update active button
            distributeEvenlyBtn.classList.remove('active');
            distributeFirstBtn.classList.remove('active');
            distributeLastBtn.classList.remove('active');
            
            if (method === 'evenly') {
                distributeEvenlyBtn.classList.add('active');
            } else if (method === 'first') {
                distributeFirstBtn.classList.add('active');
            } else if (method === 'last') {
                distributeLastBtn.classList.add('active');
            }
            
            saveToLocalStorage();
        }

        // Set up drag and drop
        function setupDragAndDrop() {
            // Prevent default drag behaviors
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                dropArea.addEventListener(eventName, preventDefaults, false);
                document.body.addEventListener(eventName, preventDefaults, false);
            });
            
            // Highlight drop area when item is dragged over it
            ['dragenter', 'dragover'].forEach(eventName => {
                dropArea.addEventListener(eventName, highlight, false);
            });
            
            ['dragleave', 'drop'].forEach(eventName => {
                dropArea.addEventListener(eventName, unhighlight, false);
            });
            
            // Handle dropped files
            dropArea.addEventListener('drop', handleDrop, false);
            
            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }
            
            function highlight() {
                dropArea.classList.add('dragover');
            }
            
            function unhighlight() {
                dropArea.classList.remove('dragover');
            }
            
            function handleDrop(e) {
                const dt = e.dataTransfer;
                const files = dt.files;
                
                if (files.length > 0) {
                    handleFile(files[0]);
                }
            }
        }

        // Handle file selection
        function handleFileSelect(e) {
            const files = e.target.files;
            if (files.length > 0) {
                handleFile(files[0]);
            }
        }

        // Process uploaded file
        function handleFile(file) {
            if (!file) return;
            
            const fileType = file.name.split('.').pop().toLowerCase();
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    let students = [];
                    
                    if (fileType === 'txt' || fileType === 'csv') {
                        // Process text or CSV file
                        const content = e.target.result;
                        students = parseTextFile(content);
                    } else if (fileType === 'xlsx' || fileType === 'xls') {
                        // Process Excel file
                        showNotification('Excel files require additional libraries. Please use TXT or CSV files.', 'error');
                        return;
                    } else {
                        showNotification('Unsupported file type. Please upload TXT or CSV files.', 'error');
                        return;
                    }
                    
                    // Add students to list
                    addStudentsFromFile(students);
                    
                } catch (error) {
                    console.error('Error processing file:', error);
                    showNotification('Error processing file. Please check the file format.', 'error');
                }
            };
            
            reader.onerror = function() {
                showNotification('Error reading file', 'error');
            };
            
            if (fileType === 'txt' || fileType === 'csv') {
                reader.readAsText(file);
            } else {
                reader.readAsBinaryString(file);
            }
            
            // Show file preview
            showFilePreview(file);
        }

        // Parse text file content
        function parseTextFile(content) {
            const students = [];
            const lines = content.split('\n');
            
            for (let line of lines) {
                line = line.replace(/\r/g, '').trim();
                
                if (!line) continue;
                
                if (line.includes(',')) {
                    const parts = line.split(',');
                    for (let part of parts) {
                        const name = part.trim();
                        if (name && !students.includes(name)) {
                            students.push(name);
                        }
                    }
                } else {
                    if (!students.includes(line)) {
                        students.push(line);
                    }
                }
            }
            
            return students;
        }

        // Add students from file
        function addStudentsFromFile(students) {
            if (!students || students.length === 0) {
                showNotification('No valid student names found in the file', 'error');
                return;
            }
            
            let addedCount = 0;
            for (let student of students) {
                if (student && !state.students.includes(student)) {
                    state.students.push(student);
                    addedCount++;
                }
            }
            
            updateStudentList();
            drawWheel();
            saveToLocalStorage();
            
            showNotification(`Added ${addedCount} students from file`);
        }

        // Show file preview
        function showFilePreview(file) {
            if (!file) return;
            
            const fileSize = (file.size / 1024).toFixed(2);
            
            filePreview.innerHTML = `
                <h4>File Preview</h4>
                <p><strong>File Name:</strong> ${file.name}</p>
                <p><strong>File Size:</strong> ${fileSize} KB</p>
                <p><strong>Type:</strong> ${file.type || 'Unknown'}</p>
                <p><span class="preview-count">${state.students.length}</span> students in list</p>
            `;
        }

        // Update canvas size based on container
        function updateCanvasSize() {
            const wheelContainer = document.getElementById('wheel');
            const size = Math.min(wheelContainer.offsetWidth, 500);
            
            wheelCanvas.width = size;
            wheelCanvas.height = size;
            wheelRadius = size / 2;
            
            drawWheel();
        }

        // Draw the wheel
        function drawWheel() {
            ctx.clearRect(0, 0, wheelCanvas.width, wheelCanvas.height);
            
            if (state.students.length === 0) {
                drawEmptyWheel();
                return;
            }
            
            const segmentAngle = (2 * Math.PI) / state.students.length;
            state.wheelSegments = [];
            
            for (let i = 0; i < state.students.length; i++) {
                const startAngle = i * segmentAngle + currentRotation;
                const endAngle = (i + 1) * segmentAngle + currentRotation;
                
                state.wheelSegments.push({
                    startAngle,
                    endAngle,
                    student: state.students[i]
                });
                
                ctx.beginPath();
                ctx.moveTo(wheelRadius, wheelRadius);
                ctx.arc(wheelRadius, wheelRadius, wheelRadius, startAngle, endAngle);
                ctx.closePath();
                
                ctx.fillStyle = state.colors[i % state.colors.length];
                ctx.fill();
                
                ctx.strokeStyle = 'white';
                ctx.lineWidth = 2;
                ctx.stroke();
                
                ctx.save();
                ctx.translate(wheelRadius, wheelRadius);
                ctx.rotate(startAngle + segmentAngle / 2);
                ctx.textAlign = 'right';
                ctx.fillStyle = 'white';
                ctx.font = `bold ${Math.max(14, wheelRadius / 15)}px Segoe UI`;
                
                let displayName = state.students[i];
                if (displayName.length > 15) {
                    displayName = displayName.substring(0, 12) + '...';
                }
                
                ctx.fillText(displayName, wheelRadius - 20, 5);
                ctx.restore();
            }
            
            ctx.beginPath();
            ctx.arc(wheelRadius, wheelRadius, 15, 0, 2 * Math.PI);
            ctx.fillStyle = '#333';
            ctx.fill();
            ctx.strokeStyle = 'white';
            ctx.lineWidth = 3;
            ctx.stroke();
        }

        // Draw empty wheel
        function drawEmptyWheel() {
            ctx.beginPath();
            ctx.arc(wheelRadius, wheelRadius, wheelRadius, 0, 2 * Math.PI);
            ctx.fillStyle = '#f0f0f0';
            ctx.fill();
            ctx.strokeStyle = '#ddd';
            ctx.lineWidth = 3;
            ctx.stroke();
            
            ctx.fillStyle = '#aaa';
            ctx.font = `bold ${wheelRadius / 10}px Segoe UI`;
            ctx.textAlign = 'center';
            ctx.fillText('Add students to begin', wheelRadius, wheelRadius);
            
            ctx.beginPath();
            ctx.arc(wheelRadius, wheelRadius, 15, 0, 2 * Math.PI);
            ctx.fillStyle = '#ccc';
            ctx.fill();
        }

        // Spin the wheel
        function spinWheel() {
            if (state.wheelSpinning || state.students.length === 0) return;
            
            const groupSize = parseInt(groupSizeSelect.value);
            const groupCountValue = groupCountSelect.value;
            
            let groupCount;
            if (groupCountValue === 'auto') {
                if (groupSize === 0) {
                    groupCount = Math.ceil(state.students.length / 3);
                } else {
                    groupCount = Math.ceil(state.students.length / groupSize);
                }
            } else {
                groupCount = parseInt(groupCountValue);
            }
            
            if (state.students.length < groupCount) {
                showNotification(`Not enough students. Need at least ${groupCount} students for ${groupCount} groups.`, 'error');
                return;
            }
            
            state.wheelSpinning = true;
            spinButton.disabled = true;
            spinButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Spinning...';
            
            createGroups(groupCount);
            
            const spinDuration = 3000;
            const spinCycles = 5;
            const finalRotation = spinCycles * 2 * Math.PI + Math.random() * 2 * Math.PI;
            
            let startTime = null;
            
            function animateSpin(timestamp) {
                if (!startTime) startTime = timestamp;
                const elapsed = timestamp - startTime;
                const progress = Math.min(elapsed / spinDuration, 1);
                
                const easeOut = 1 - Math.pow(1 - progress, 3);
                currentRotation = easeOut * finalRotation;
                drawWheel();
                
                if (progress < 1) {
                    spinAnimation = requestAnimationFrame(animateSpin);
                } else {
                    state.wheelSpinning = false;
                    spinButton.disabled = false;
                    spinButton.innerHTML = '<i class="fas fa-redo-alt"></i> Spin the Wheel';
                    
                    displayGroups();
                    saveToLocalStorage();
                    
                    showNotification(`Created ${state.groups.length} groups successfully!`);
                }
            }
            
            spinAnimation = requestAnimationFrame(animateSpin);
        }

        // Create groups based on distribution method
        function createGroups(groupCount) {
            const shuffledStudents = [...state.students];
            shuffleArray(shuffledStudents);
            
            state.groups = Array.from({ length: groupCount }, () => []);
            
            const idealGroupSize = Math.floor(shuffledStudents.length / groupCount);
            const remainder = shuffledStudents.length % groupCount;
            
            if (state.distributionMethod === 'evenly') {
                distributeEvenly(shuffledStudents, groupCount, idealGroupSize, remainder);
            } else if (state.distributionMethod === 'first') {
                distributeToFirstGroups(shuffledStudents, groupCount, idealGroupSize, remainder);
            } else if (state.distributionMethod === 'last') {
                distributeToLastGroups(shuffledStudents, groupCount, idealGroupSize, remainder);
            }
            
            state.groups = state.groups.filter(group => group.length > 0);
        }

        // Distribute students evenly
        function distributeEvenly(students, groupCount, idealSize, remainder) {
            let studentIndex = 0;
            
            for (let i = 0; i < groupCount; i++) {
                for (let j = 0; j < idealSize; j++) {
                    if (studentIndex < students.length) {
                        state.groups[i].push(students[studentIndex]);
                        studentIndex++;
                    }
                }
            }
            
            for (let i = 0; i < remainder; i++) {
                if (studentIndex < students.length) {
                    state.groups[i].push(students[studentIndex]);
                    studentIndex++;
                }
            }
        }

        // Distribute extra students to first groups
        function distributeToFirstGroups(students, groupCount, idealSize, remainder) {
            let studentIndex = 0;
            const groupSizes = Array(groupCount).fill(idealSize);
            
            for (let i = 0; i < remainder; i++) {
                groupSizes[i]++;
            }
            
            for (let i = 0; i < groupCount; i++) {
                for (let j = 0; j < groupSizes[i]; j++) {
                    if (studentIndex < students.length) {
                        state.groups[i].push(students[studentIndex]);
                        studentIndex++;
                    }
                }
            }
        }

        // Distribute extra students to last groups
        function distributeToLastGroups(students, groupCount, idealSize, remainder) {
            let studentIndex = 0;
            const groupSizes = Array(groupCount).fill(idealSize);
            
            for (let i = groupCount - 1; i >= groupCount - remainder; i--) {
                groupSizes[i]++;
            }
            
            for (let i = 0; i < groupCount; i++) {
                for (let j = 0; j < groupSizes[i]; j++) {
                    if (studentIndex < students.length) {
                        state.groups[i].push(students[studentIndex]);
                        studentIndex++;
                    }
                }
            }
        }

        // Display groups in the results section
        function displayGroups() {
            if (state.groups.length === 0) {
                groupsContainer.innerHTML = '<div class="empty-message">Spin the wheel to generate groups</div>';
                return;
            }
            
            const groupSizes = state.groups.map(group => group.length);
            const minSize = Math.min(...groupSizes);
            const maxSize = Math.max(...groupSizes);
            const hasUnevenGroups = minSize !== maxSize;
            
            let groupsHTML = '';
            
            state.groups.forEach((group, index) => {
                const isUneven = group.length !== minSize && hasUnevenGroups;
                
                let membersHTML = '';
                group.forEach(member => {
                    membersHTML += `<li class="group-member">${member}</li>`;
                });
                
                groupsHTML += `
                    <div class="group-card ${isUneven ? 'uneven' : ''}">
                        <div class="group-header">
                            <div class="group-name">Group ${index + 1}</div>
                            <div class="group-count">${group.length}</div>
                        </div>
                        <ul class="group-members">
                            ${membersHTML}
                        </ul>
                    </div>
                `;
            });
            
            if (hasUnevenGroups) {
                const extraStudents = maxSize - minSize;
                groupsHTML += `
                    <div class="empty-message" style="grid-column: 1 / -1; text-align: left; background: #fff5f5; border-radius: 10px;">
                        <p><strong>Note:</strong> Groups are uneven due to student count.</p>
                        <p>Some groups have ${extraStudents} extra student(s).</p>
                        <p>Distribution method: <strong>${state.distributionMethod}</strong></p>
                    </div>
                `;
            }
            
            groupsContainer.innerHTML = groupsHTML;
        }

        // Add a student
        function addStudent() {
            const name = studentInput.value.trim();
            
            if (name === '') {
                showNotification('Please enter a student name', 'error');
                return;
            }
            
            if (state.students.includes(name)) {
                showNotification('This student is already in the list', 'error');
                return;
            }
            
            state.students.push(name);
            studentInput.value = '';
            updateStudentList();
            drawWheel();
            saveToLocalStorage();
            
            showNotification(`Added student: ${name}`);
        }

        // Update the student list display
        function updateStudentList() {
            studentCount.textContent = `${state.students.length} students`;
            
            if (filePreview.innerHTML) {
                const previewElement = filePreview.querySelector('.preview-count');
                if (previewElement) {
                    previewElement.textContent = state.students.length;
                }
            }
            
            if (state.students.length === 0) {
                studentList.innerHTML = '<li class="empty-message">No students added yet. Add students above or upload a file.</li>';
                return;
            }
            
            let studentsHTML = '';
            
            state.students.forEach((student, index) => {
                studentsHTML += `
                    <li class="student-item">
                        <span>${student}</span>
                        <button class="remove-student" data-index="${index}">
                            <i class="fas fa-times"></i>
                        </button>
                    </li>
                `;
            });
            
            studentList.innerHTML = studentsHTML;
            
            document.querySelectorAll('.remove-student').forEach(button => {
                button.addEventListener('click', function() {
                    const index = parseInt(this.getAttribute('data-index'));
                    removeStudent(index);
                });
            });
        }

        // Remove a student
        function removeStudent(index) {
            const removedStudent = state.students[index];
            state.students.splice(index, 1);
            updateStudentList();
            drawWheel();
            saveToLocalStorage();
            
            showNotification(`Removed student: ${removedStudent}`);
        }

        // Clear all students
        function clearStudents() {
            if (state.students.length === 0) return;
            
            if (confirm(`Are you sure you want to remove all ${state.students.length} students?`)) {
                state.students = [];
                updateStudentList();
                drawWheel();
                saveToLocalStorage();
                
                filePreview.innerHTML = '';
                
                showNotification('All students removed');
            }
        }

        // Add sample students
        function addSampleStudents() {
            const sampleStudents = [
                'Alex Johnson', 'Maria Garcia', 'David Chen', 'Sarah Williams',
                'James Miller', 'Emma Davis', 'Michael Brown', 'Olivia Wilson',
                'Daniel Taylor', 'Sophia Martinez', 'Robert Anderson', 'Isabella Thomas',
                'William Jackson', 'Mia White', 'Joseph Harris', 'Charlotte Martin'
            ];
            
            sampleStudents.forEach(student => {
                if (!state.students.includes(student)) {
                    state.students.push(student);
                }
            });
            
            updateStudentList();
            drawWheel();
            saveToLocalStorage();
            
            showNotification(`Added ${sampleStudents.length} sample students`);
        }

        // Export groups
        function exportGroups() {
            if (state.groups.length === 0) {
                showNotification('No groups to export. Spin the wheel first.', 'error');
                return;
            }
            
            let exportText = 'STUDENT GROUPS\n';
            exportText += `Generated on: ${new Date().toLocaleDateString()} ${new Date().toLocaleTimeString()}\n`;
            exportText += `Total Students: ${state.students.length}\n`;
            exportText += `Number of Groups: ${state.groups.length}\n`;
            exportText += `Distribution Method: ${state.distributionMethod}\n`;
            exportText += `Group Configuration: ${groupSizeSelect.value === '0' ? 'Custom' : groupSizeSelect.value} students per group\n\n`;
            
            state.groups.forEach((group, index) => {
                const groupSize = group.length;
                const minSize = Math.min(...state.groups.map(g => g.length));
                const isUneven = groupSize !== minSize;
                
                exportText += `GROUP ${index + 1} (${groupSize} student${groupSize !== 1 ? 's' : ''})${isUneven ? ' [UNEVEN]' : ''}:\n`;
                group.forEach(student => {
                    exportText += `  â€¢ ${student}\n`;
                });
                exportText += '\n';
            });
            
            const groupSizes = state.groups.map(group => group.length);
            const minSize = Math.min(...groupSizes);
            const maxSize = Math.max(...groupSizes);
            
            if (minSize !== maxSize) {
                exportText += `SUMMARY:\n`;
                exportText += `  - Smallest group: ${minSize} students\n`;
                exportText += `  - Largest group: ${maxSize} students\n`;
                exportText += `  - Extra students in some groups: ${maxSize - minSize}\n`;
            }
            
            const blob = new Blob([exportText], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            const dateStr = new Date().toISOString().slice(0, 10);
            a.download = `student-groups-${dateStr}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('Groups exported successfully');
        }

        // Export student list
        function exportStudentList() {
            if (state.students.length === 0) {
                showNotification('No students to export', 'error');
                return;
            }
            
            let exportText = 'STUDENT LIST\n';
            exportText += `Exported on: ${new Date().toLocaleDateString()} ${new Date().toLocaleTimeString()}\n`;
            exportText += `Total Students: ${state.students.length}\n\n`;
            
            state.students.forEach((student, index) => {
                exportText += `${index + 1}. ${student}\n`;
            });
            
            const blob = new Blob([exportText], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            const dateStr = new Date().toISOString().slice(0, 10);
            a.download = `student-list-${dateStr}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('Student list exported successfully');
        }

        // Reset groups
        function resetGroups() {
            if (state.groups.length === 0) return;
            
            if (confirm('Are you sure you want to reset all groups?')) {
                state.groups = [];
                displayGroups();
                showNotification('Groups reset successfully');
            }
        }

        // Show notification
        function showNotification(message, type = 'success') {
            notification.textContent = message;
            notification.className = 'notification';
            
            if (type === 'error') {
                notification.classList.add('error');
            } else if (type === 'info') {
                notification.classList.add('info');
            }
            
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // Utility function to shuffle array
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Save data to localStorage
        function saveToLocalStorage() {
            const data = {
                students: state.students,
                groups: state.groups,
                groupSize: groupSizeSelect.value,
                groupCount: groupCountSelect.value,
                distributionMethod: state.distributionMethod
            };
            
            localStorage.setItem('studentGroupSpinner', JSON.stringify(data));
        }

        // Load data from localStorage
        function loadFromLocalStorage() {
            const savedData = localStorage.getItem('studentGroupSpinner');
            
            if (savedData) {
                try {
                    const data = JSON.parse(savedData);
                    state.students = data.students || [];
                    state.groups = data.groups || [];
                    
                    if (data.groupSize) groupSizeSelect.value = data.groupSize;
                    if (data.groupCount) groupCountSelect.value = data.groupCount;
                    if (data.distributionMethod) setDistributionMethod(data.distributionMethod);
                    
                    updateStudentList();
                    displayGroups();
                    
                    if (state.students.length > 0) {
                        showNotification(`Loaded ${state.students.length} students from previous session`, 'info');
                    }
                } catch (e) {
                    console.error('Error loading saved data:', e);
                }
            }
        }

        // Initialize the app
        window.addEventListener('DOMContentLoaded', init);
    </script>    
</body>
</html>